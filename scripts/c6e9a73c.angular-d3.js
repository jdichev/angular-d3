"use strict";angular.module("angular-D3-lineChart",[]).directive("lineChart",function(){return{template:"<div></div>",scope:{lineChartData:"=chartData",lineChartConfig:"=chartConfig"},replace:!0,restrict:"AE",link:function(a,b){function c(){for(var c={top:20,right:20,bottom:30,left:50},d=window.d3,e=b.width()-c.left-c.right,f=300-c.top-c.bottom,g=200,h=32,i=function(a){var b=e/2;return a>b?a+-1*(g+g/2):a+g/2},j=d.scale.category10(),k=d.time.format("%Y-%m").parse,l=d.bisector(function(a){return a.date}).left,m=d.time.scale().range([0,e]),n=d.scale.linear().range([f,0]),o=d.svg.axis().scale(m).orient("bottom").tickSize(4),p=d.svg.axis().scale(n).orient("left"),q=d.svg.line().x(function(a){return m(a.date)}).y(function(a){return n(a.value)}),r=d.select(b[0]).append("svg").attr("width",e+c.left+c.right).attr("height",f+c.top+c.bottom).append("g").attr("transform","translate("+c.left+","+c.top+")"),s=[],t=1,u=a.lineChartData[0].length;u>t;t+=1){for(var v={name:a.lineChartData[0][t],values:[]},w=1,x=a.lineChartData.length;x>w;w+=1)v.values.push({date:k(a.lineChartData[w][0]),value:a.lineChartData[w][t]});s.push(v)}m.domain(d.extent(a.lineChartData,function(a){return k(a[0])})),n.domain([d.min(s,function(a){return d.min(a.values,function(a){return a.value})}),d.max(s,function(a){return d.max(a.values,function(a){return a.value})})]),r.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(o).selectAll("text").style("text-anchor","end"),r.append("g").attr("class","y axis").call(p).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("values");var y=r.selectAll(".data-column").data(s).enter().append("g").attr("class","data-column");y.append("path").attr("class","line").attr("d",function(a){return q(a.values)}).style("stroke",function(a){return j(a.name)});var z=r.selectAll(".focus").data(s).enter().append("g").attr("class","focus").style("display","none");z.append("circle").attr("r",3);var A=r.selectAll(".preview-overlay").data(s).enter().append("g").attr("class","preview-overlay").style("display","none"),B=function(){return f/2-s.length*h/2}();A.append("rect").attr("width",g).attr("height",h),A.append("text"),r.append("rect").attr("class","overlay").attr("width",e).attr("height",f).on("mouseover",function(){z.style("display",null),A.style("display",null)}).on("mouseout",function(){z.style("display","none"),A.style("display","none")}).on("mousemove",function(){var a=m.invert(d.mouse(this)[0]),b=l(s[0].values,d.time.month.round(a));z.attr("transform",function(a){var c=a.values[b];return"translate("+m(c.date)+","+n(c.value)+")"}),A.transition().duration(300).delay(0).attr("transform",function(a,c){var d=a.values[b];return"translate("+i(m(d.date))+","+(B+c*h)+")"}),A.selectAll("text").text(function(a){var c=a.values[b];return c.value+" ("+a.name+")"}).style("fill",function(a){return j(a.name)}).style("text-anchor",function(a){var c=a.values[b];return m(c.date)>e/2?"end":"start"}).attr("transform",function(a){var c=a.values[b];return m(c.date)>e/2?"translate("+(g-10)+",20)":"translate(10,20)"})})}a.$watch("lineChartData",function(a){"undefined"!=typeof a&&c()})}}}),angular.module("angular-D3",["angular-D3-lineChart"]);